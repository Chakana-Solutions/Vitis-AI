<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>VEK280 DPUCV2DX8G Reference Design &mdash; Vitis™ AI 3.5 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Vitis AI Model Zoo" href="../workflow-model-zoo.html" />
    <link rel="prev" title="What is a DPU?" href="../workflow-system-integration.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../index.html" class="icon icon-home"> Vitis™ AI
            <img src="../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Setup and Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/system_requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">Host Install Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/vek280.html">Quick Start Guide for VEK280</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/v70.html">Quick Start Guide for V70</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/custom_target.html">Quick Start Guide for Custom Targets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Workflow and Components</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../workflow.html">First Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html#supported-evaluation-targets">Supported Evaluation Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-system-integration.html">What is a DPU?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-system-integration.html#vitis-ai-dpu-ip-and-reference-designs">Vitis AI DPU IP and Reference Designs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-system-integration.html#integrating-the-dpu">Integrating the DPU</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">VEK280 DPUCV2DX8G Reference Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#revision-history">1 Revision History</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview">2 Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#software-tools-and-system-requirements">3 Software Tools and System Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hardware">3.1 Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#software">3.2 Software</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#note-bash-is-used-during-the-build-but-some-csh-scripts-are-used"><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">bash</span></code> is used during the build but some <code class="docutils literal notranslate"><span class="pre">csh</span></code> scripts are used.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#design-files">4 Design Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#design-components">4.1 Design Components</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tutorials">5 Tutorials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#board-setup">5.1 Board Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#board-jumper-and-switch-settings">Board jumper and switch settings:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-and-run-trd-flow">5.2 Build and Run TRD Flow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-the-dpu">5.2.1 Build the DPU</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-json-file">5.2.2 Get Json File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-resnet50-example">5.2.3 Run ResNet50 Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#change-the-configuration">5.3 Change the Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#instructions-for-changing-the-platform">6 Instructions for Changing the Platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dpucv2dx8g-ports">6.1 DPUCV2DX8G Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#changing-the-platform">6.2 Changing the Platform</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#instructions-for-adding-other-kernels">7 Instructions for Adding Other Kernels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rtl-kernel">7.1 RTL Kernel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#known-issues">8 Known Issues</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-model-zoo.html">Vitis AI Model Zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-model-development.html">Developing a Model for Vitis AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-model-deployment.html">Deploying a Model with Vitis AI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Runtime API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../doxygen/api/classlist.html">Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doxygen/api/filelist.html">File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doxygen/api/namespacelist.html">Namespace</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/release_documentation.html">Vitis AI User Guides &amp; IP Product Guides</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/Vitis-AI-Tutorials">Vitis AI Developer Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow-third-party.html">Third-party Inference Stack Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/version_compatibility.html">IP and Tools Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/branching_tagging_strategy.html">Branching and Tagging Strategy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources and Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/additional_resources.html">Technical Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/additional_resources.html#id1">Additional Resources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Related AMD Solutions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/DPU-PYNQ">DPU-PYNQ</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/finn/">FINN &amp; Brevitas</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/inference-server/">Inference Server</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/amd/UIF">Unified Inference Frontend</a></li>
<li class="toctree-l1"><a class="reference external" href="https://onnxruntime.ai/docs/execution-providers/community-maintained/Vitis-AI-ExecutionProvider.html">Vitis AI ONNX Runtime Execution Provider</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/VVAS/">Vitis Video Analytics SDK</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Vitis™ AI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>VEK280 DPUCV2DX8G Reference Design</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/ref_design_docs/README_DPUCV2DX8G.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vek280-dpucv2dx8g-reference-design">
<h1>VEK280 DPUCV2DX8G Reference Design<a class="headerlink" href="#vek280-dpucv2dx8g-reference-design" title="Permalink to this heading">¶</a></h1>
<p><strong>Note:</strong> This design is based on the B01 version of the VEK280 evaluation board.  It can also be leveraged with the A01 version of the board with specific limitations that are outlined below.</p>
<p>The reference design associated with this document <a class="reference external" href="https://www.xilinx.com/bin/public/openDownload?filename=DPUCV2DX8G_VAI_v3.5.tar.gz">is found here</a>.</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#1-revision-history">1 Revision History</a></p></li>
<li><p><a class="reference external" href="#2-overview">2 Overview</a></p></li>
<li><p><a class="reference external" href="#3-software-tools-and-system-requirements">3 Software Tools and System Requirements</a></p>
<ul>
<li><p><a class="reference external" href="#31-hardware">3.1 Hardware</a></p></li>
<li><p><a class="reference external" href="#32-software">3.2 Software</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#4-design-files">4 Design Files</a></p>
<ul>
<li><p><a class="reference external" href="#41-design-components">4.1 Design Components</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#5-tutorials">5 Tutorials</a></p>
<ul>
<li><p><a class="reference external" href="#51-board-setup">5.1 Board Setup</a></p></li>
<li><p><a class="reference external" href="#52-build-and-run-trd-flow">5.2 Build and Run TRD Flow</a></p>
<ul>
<li><p><a class="reference external" href="#521-build-the-dpu">5.2.1 Build the DPU</a></p></li>
<li><p><a class="reference external" href="#522-get-json-file">5.2.2 Get Json File</a></p></li>
<li><p><a class="reference external" href="#523-run-resnet50-example">5.2.3 Run ResNet50 Example</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#53-change-the-configuration">5.3 Change the Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#6-instructions-for-changing-the-platform">6 Instructions for Changing the Platform</a></p>
<ul>
<li><p><a class="reference external" href="#61-dpucv2dx8g-ports">6.1 DPUCV2DX8G Ports</a></p></li>
<li><p><a class="reference external" href="#62-changing-the-platform">6.2 Changing the Platform</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#7-instructions-for-adding-other-kernels">7 Instructions for Adding Other Kernels</a></p>
<ul>
<li><p><a class="reference external" href="#71-rtl-kernel">7.1 RTL Kernel</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#8-known-issues">8 Known Issues </a></p></li>
</ul>
</section>
<section id="revision-history">
<h2>1 Revision History<a class="headerlink" href="#revision-history" title="Permalink to this heading">¶</a></h2>
<p>Vitis3.5 Change log:</p>
<ul class="simple">
<li><p>Update platform to rev-B ES board, and support vitis 2023.1.</p></li>
<li><p>Support multi-batch setting</p></li>
</ul>
<p>Vitis3.0 Change log:</p>
<ul class="simple">
<li><p>Initial early access version</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="overview">
<h2>2 Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>The Xilinx Versal Deep Learning Processing Unit (DPUCV2DX8G) is a computation engine optimized for convolutional neural networks.
It includes a set of highly optimized instructions, and supports most convolutional neural networks, such as VGG, ResNet, GoogLeNet, YOLO, SSD, MobileNet, and others.</p>
<p>This tutorial contains information about:</p>
<ul class="simple">
<li><p>How to set up the VEK280 evaluation board.</p></li>
<li><p>How to build and run the DPUCV2DX8G TRD with VEK280 platform in Vitis environment.</p></li>
<li><p>How to change platform.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="software-tools-and-system-requirements">
<h2>3 Software Tools and System Requirements<a class="headerlink" href="#software-tools-and-system-requirements" title="Permalink to this heading">¶</a></h2>
<section id="hardware">
<h3>3.1 Hardware<a class="headerlink" href="#hardware" title="Permalink to this heading">¶</a></h3>
<p>Required:</p>
<ul class="simple">
<li><p>ES version of the VEK280 evaluation board</p></li>
<li><p>USB type-C cable, connected to a PC for the terminal emulator</p></li>
<li><p>SD card</p></li>
</ul>
<p><strong>Note:</strong>  if you only have rev-A ES board, a USB Ethernet Adapter is also required</p>
</section>
<section id="software">
<h3>3.2 Software<a class="headerlink" href="#software" title="Permalink to this heading">¶</a></h3>
<p>Required:</p>
<ul class="simple">
<li><p>Vitis 2023.1</p></li>
<li><p>Python (version 2.7.5 or 3.6.8)</p></li>
<li><p>csh</p></li>
</ul>
<section id="note-bash-is-used-during-the-build-but-some-csh-scripts-are-used">
<h4><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">bash</span></code> is used during the build but some <code class="docutils literal notranslate"><span class="pre">csh</span></code> scripts are used.<a class="headerlink" href="#note-bash-is-used-during-the-build-but-some-csh-scripts-are-used" title="Permalink to this heading">¶</a></h4>
</section>
</section>
</section>
<hr class="docutils" />
<section id="design-files">
<h2>4 Design Files<a class="headerlink" href="#design-files" title="Permalink to this heading">¶</a></h2>
<section id="design-components">
<h3>4.1 Design Components<a class="headerlink" href="#design-components" title="Permalink to this heading">¶</a></h3>
<p>The top-level directory structure shows the the major design components.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── app
├── README.md
├── vek280_platform                        # VEK280 platform folder
│   ├── LICENSE            
│   ├── Makefile 
│   ├── hw 
│   ├── sw 
│   ├── platform
│   ├── platform.mk
│   └── README.md 
├── vitis_prj                              # Vitis project folder
│   ├── Makefile
│   ├── scripts
│   ├── xv2dpu
│   └── xv2dpu_config.mk
└── xv2dpu_ip                              # DPUCV2DX8G IP folder
    ├── aie
    └── rtl
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="tutorials">
<h2>5 Tutorials<a class="headerlink" href="#tutorials" title="Permalink to this heading">¶</a></h2>
<section id="board-setup">
<h3>5.1 Board Setup<a class="headerlink" href="#board-setup" title="Permalink to this heading">¶</a></h3>
<section id="board-jumper-and-switch-settings">
<h4>Board jumper and switch settings:<a class="headerlink" href="#board-jumper-and-switch-settings" title="Permalink to this heading">¶</a></h4>
<p>Make sure the board is set as booting from SD card :</p>
<ul class="simple">
<li><p>SW1[4:1]- [OFF,OFF,OFF,ON].</p></li>
</ul>
</section>
</section>
<section id="build-and-run-trd-flow">
<h3>5.2 Build and Run TRD Flow<a class="headerlink" href="#build-and-run-trd-flow" title="Permalink to this heading">¶</a></h3>
<p>The following tutorials assume that the ‘$TRD_HOME’ environment variable is set as shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">export</span> <span class="n">TRD_HOME</span> <span class="o">=&lt;</span><span class="n">Vitis</span> <span class="n">AI</span> <span class="n">path</span><span class="o">&gt;/</span><span class="n">reference_design</span><span class="o">/</span><span class="n">DPUCV2DX8G</span><span class="o">-</span><span class="n">TRD</span>
</pre></div>
</div>
<p><strong>Step1:</strong> Build VEK280 platform</p>
<p>Firstly, build the VEK280 platform in the folder ‘$TRD_HOME/vek280_platform’, following the instructions in ‘$TRD_HOME/vek280_platform/README.md”.</p>
<p><strong>Step2:</strong> Setup environment for building DPUCV2DX8G</p>
<p>When platform is ready, set the Vitis environment variable as given below.</p>
<p>Open a linux terminal. Set the linux as Bash mode.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">source</span> <span class="o">&lt;</span><span class="n">vitis</span> <span class="n">install</span> <span class="n">path</span><span class="o">&gt;/</span><span class="n">Vitis</span><span class="o">/</span><span class="mf">2023.1</span><span class="o">/</span><span class="n">settings64</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<section id="build-the-dpu">
<h4>5.2.1 Build the DPU<a class="headerlink" href="#build-the-dpu" title="Permalink to this heading">¶</a></h4>
<p>The default architecture of DPUCV2DX8G is C20B1 (CU_N=1, BATCH_SingleCU=1, 16 AIE-ML cores for Convolution, 4 AIE-ML cores for Non-Convolution), PL clock frequency is 300 MHz. For this vesion TRD, it only supports CU_N=1, but can supports BATCH_SingleCU to 1~14. Modify file ‘$TRD_HOME/vitis_prj/xv2dpu_config.mk’ can change the parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% cd $TRD_HOME/vitis_prj

% make all
</pre></div>
</div>
<p>The generated SD card image:  $TRD_HOME/vitis_prj/package_out/sd_card.img.gz</p>
<p>The implemented Vivado project: $TRD_HOME/vitis_prj/hw/binary_container_1/link/vivado/vpl/prj/prj.xpr</p>
<p><strong>Note1:</strong> With ‘make help’ to see more detailed information about the commands.</p>
<p><strong>Note2:</strong> The implementation strategy is set in the file ‘$TRD_HOME/vitis_prj/scripts/system.cfg’, the default strategy is “ prop=run.impl_1.strategy=Performance_ExploreWithRemap “.
The implementation strategy may be changed by editing <code class="docutils literal notranslate"><span class="pre">system.cfg</span></code>.</p>
<p><strong>Note3:</strong> With same configuration of DPUCV2DX8G, ‘libadf.a’ file of AI Engine can be reused. Comment out the last line of ‘$TRD_HOME/vitis_prj/Makefile’, to save compile time for re-building the hardware design.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -@rm -rf aie</span>
</pre></div>
</div>
</section>
<section id="get-json-file">
<h4>5.2.2 Get Json File<a class="headerlink" href="#get-json-file" title="Permalink to this heading">¶</a></h4>
<p>The ‘arch.json’ file is an important file required by Vitis AI. It works together with Vitis AI compiler to support model compilation with various DPUCV2DX8G configurations. The ‘arch.json’ file will be generated by Vitis during the compilation of DPUCV2DX8G TRD, it can be found in ‘$TRD_HOME/vitis_prj/package_out/sd_card’ .</p>
<p>It can also be found in the following path:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$TRD_HOME/vitis_prj/hw/binary_container_1/link/vivado/vpl/prj/prj.gen/sources_1/bd/*/ip/*_DPUCV2DX8G_*/arch.json
</pre></div>
</div>
</section>
<section id="run-resnet50-example">
<h4>5.2.3 Run ResNet50 Example<a class="headerlink" href="#run-resnet50-example" title="Permalink to this heading">¶</a></h4>
<p>The TRD project has generated the matching model file in ‘$TRD_HOME/app’ path for the default settings. If the settings of DPUCV2DX8G are modified, the model needs to be created according to the fingerprint in ‘arch.json’.</p>
<p>This section is about how to run the ResNet50 example.</p>
<p>Use the balenaEtcher tool to flash ‘$TRD_HOME/vitis_prj/package_out/sd_card.img.gz’ into SD card, insert the SD card with the image into the destination board and power-on it.
After Linux booting on board, copy the folder ‘$TRD_HOME/app’ in this TRD to the target folder “~/”, and run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">cd</span> <span class="o">~/</span><span class="n">app</span><span class="o">/</span><span class="n">model</span><span class="o">/</span>

<span class="o">%</span> <span class="n">xdputil</span> <span class="n">benchmark</span> <span class="n">resnet50</span><span class="o">.</span><span class="n">xmodel</span> <span class="mi">1</span>
</pre></div>
</div>
<p>A typical output would appear as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">I1123</span> <span class="mi">04</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">22.475286</span>  <span class="mi">1127</span> <span class="n">test_dpu_runner_mt</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">474</span><span class="p">]</span> <span class="n">shuffle</span> <span class="n">results</span> <span class="k">for</span> <span class="n">batch</span><span class="o">...</span>
<span class="n">I1123</span> <span class="mi">04</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">22.476413</span>  <span class="mi">1127</span> <span class="n">performance_test</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">73</span><span class="p">]</span> <span class="mi">0</span><span class="o">%</span> <span class="o">...</span>
<span class="n">I1123</span> <span class="mi">04</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mf">28.476716</span>  <span class="mi">1127</span> <span class="n">performance_test</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">76</span><span class="p">]</span> <span class="mi">10</span><span class="o">%</span> <span class="o">...</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="n">I1123</span> <span class="mi">04</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">22.478189</span>  <span class="mi">1127</span> <span class="n">performance_test</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">76</span><span class="p">]</span> <span class="mi">100</span><span class="o">%</span> <span class="o">...</span>
<span class="n">I1123</span> <span class="mi">04</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">22.478253</span>  <span class="mi">1127</span> <span class="n">performance_test</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">79</span><span class="p">]</span> <span class="n">stop</span> <span class="ow">and</span> <span class="n">waiting</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">threads</span> <span class="n">terminated</span><span class="o">....</span>
<span class="n">I1123</span> <span class="mi">04</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">22.478495</span>  <span class="mi">1127</span> <span class="n">performance_test</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">85</span><span class="p">]</span> <span class="n">thread</span><span class="o">-</span><span class="mi">0</span> <span class="n">processes</span> <span class="mi">20225</span> <span class="n">frames</span>
<span class="n">I1123</span> <span class="mi">04</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">22.478528</span>  <span class="mi">1127</span> <span class="n">performance_test</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">93</span><span class="p">]</span> <span class="n">it</span> <span class="n">takes</span> <span class="mi">2299</span> <span class="n">us</span> <span class="k">for</span> <span class="n">shutdown</span>
<span class="n">I1123</span> <span class="mi">04</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">22.478543</span>  <span class="mi">1127</span> <span class="n">performance_test</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">94</span><span class="p">]</span> <span class="n">FPS</span><span class="o">=</span> <span class="mf">337.061</span> <span class="n">number_of_frames</span><span class="o">=</span><span class="mi">20225</span> <span class="n">time</span><span class="o">=</span> <span class="mf">60.0039</span> <span class="n">seconds</span><span class="o">.</span>
<span class="n">I1123</span> <span class="mi">04</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mf">22.478579</span>  <span class="mi">1127</span> <span class="n">performance_test</span><span class="o">.</span><span class="n">hpp</span><span class="p">:</span><span class="mi">96</span><span class="p">]</span> <span class="n">BYEBYE</span> 
</pre></div>
</div>
<p><strong>Note:</strong> For running other networks, refer to the <a class="reference external" href="https://github.com/Xilinx/Vitis-AI">Vitis AI Github</a> and <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug1414-vitis-ai">Vitis AI User Guide</a>.</p>
</section>
</section>
<section id="change-the-configuration">
<h3>5.3 Change the Configuration<a class="headerlink" href="#change-the-configuration" title="Permalink to this heading">¶</a></h3>
<p>The DPUCV2DX8G IP provides some user-configurable parameters, refer to the document PG425 ‘Xilinx Versal DPU (DPUCV2DX8G) Product Guide’.
In this TRD, user-configurable parameters are in the file ‘$TRD_HOME/vitis_prj/xv2dpu_config.mk’. They are:</p>
<ul class="simple">
<li><p>CU_N        – Compute Unit (CU) number (only support 1 for now).</p></li>
<li><p>CPB_N       – number of AI Engine cores for Convolution per batch handler (only support 16).</p></li>
<li><p>BATCH_SingleCU – number of batch engine integrated in DPUCV2DX8G IP for CU_N=1. Support 1 to 14.</p></li>
</ul>
<p>After changing ‘$TRD_HOME/vitis_prj/xv2dpu_config.mk’, type ‘make all’ to build the design.</p>
</section>
</section>
<hr class="docutils" />
<section id="instructions-for-changing-the-platform">
<h2>6 Instructions for Changing the Platform<a class="headerlink" href="#instructions-for-changing-the-platform" title="Permalink to this heading">¶</a></h2>
<section id="dpucv2dx8g-ports">
<h3>6.1 DPUCV2DX8G Ports<a class="headerlink" href="#dpucv2dx8g-ports" title="Permalink to this heading">¶</a></h3>
<p>The DPUCV2DX8G ports are listed as below.</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Ports</th>
<th>Descriptions</th>
</tr>
</thead>
<tbody>
<tr>
<td>m*_\&lt;wgt|img|instr&gt;_axi</td>
<td>Master AXI interfaces, connected with NOC to access DDR (cips_noc in this TRD platform)</td>
</tr>
<tr>
<td>m*_\&lt;data|ctrl&gt;_axis</td>
<td>Master AXI-stream interface, connected with AI Engine (ai_engine_0).</td>
</tr>
<tr>
<td>s*_\&lt;data|done&gt;_axis</td>
<td>Slave AXI-stream interface, connected with AI Engine (ai_engine_0).</td>
</tr>
<tr>
<td>m_axi_clk</td>
<td>Input clock used for DPUCV2DX8G general logic, AXI and AXI-stream interface. Default frequency is 300M Hz in this TRD.</td>
</tr>
<tr>
<td>m_axi_aresetn</td>
<td>Active-Low reset for DPUCV2DX8G general logic.</td>
</tr>
<tr>
<td>s_axi_control</td>
<td>AXI lite interface for controlling DPUCV2DX8G registers, connected with CIPS through AXI_Smartconnect_IP.</td>
</tr>
<tr>
<td>s_axi_aclk</td>
<td>Input clock for S_AXI_CONTROL. Default frequency is 150M Hz in this TRD.</td>
</tr>
<tr>
<td>s_axi_aresetn</td>
<td>Active-Low reset for S_AXI_CONTROL.</td>
</tr>
<tr>
<td>interrupt</td>
<td>Interrupt signal generated by DPUCV2DX8G.</td>
</tr>
</tbody>
</table><p>DPUCV2DX8G’s connection with AI Engine array and NOC are all defined in the ‘$TRD_HOME/vitis_prj/scripts/xv2dpu_aie_noc.cfg’ (generated by ‘xv2dpu_aie_noc.py’).</p>
<p>For the clock design, make sure that:</p>
<ul class="simple">
<li><p>s_axi_aclk for ‘s_axi_control’ should use clock with lower frequency (e.g. 150M Hz) to get better timing.</p></li>
<li><p>‘AI Engine Core Frequency’ should be 4 times of DPUCV2DX8G’s m_axi_clk, or the maximum AI Engine frequency. In this TRD, it is 1250M Hz (the maximum AI Engine frequency of XCVE2802-2MP device on the VEK280 board). The value of ‘AI Engine Core Frequency’ can be set in the platform design files or ‘vitis_prj/scripts/postlink.tcl’.</p></li>
</ul>
</section>
<section id="changing-the-platform">
<h3>6.2 Changing the Platform<a class="headerlink" href="#changing-the-platform" title="Permalink to this heading">¶</a></h3>
<p>Changing platform needs to modify 1 files: ‘vitis_prj/Makefile’.</p>
<p><strong>Note:</strong> This target platform is based on ES device.</p>
<ol class="simple">
<li><p>‘vitis_prj/Makefile’:</p></li>
</ol>
<ul class="simple">
<li><p>Change the path of ‘xpfm’ file for the varibale ‘PLATFORM’</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">PLATFORM</span>           <span class="o">=</span> <span class="o">*/*.</span><span class="n">xpfm</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Change the path of ‘rootfs.exts’ and ‘Image’ in the package section (at the bottom of Makefile)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">--</span><span class="n">package</span><span class="o">.</span><span class="n">rootfs</span>     <span class="o">*/</span><span class="n">rootfs</span><span class="o">.</span><span class="n">ext4</span> \
  <span class="o">--</span><span class="n">package</span><span class="o">.</span><span class="n">sd_file</span>    <span class="o">*/</span><span class="n">Image</span> \
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="instructions-for-adding-other-kernels">
<h2>7 Instructions for Adding Other Kernels<a class="headerlink" href="#instructions-for-adding-other-kernels" title="Permalink to this heading">¶</a></h2>
<p>Vitis kernels developed for Versal devices, could be RTL kernel (only use PL resouces), AIE kernel (only uses AI Engine tiles), or kernel including both PL and AIE. The basic instructions for adding other kernels in this TRD are shown below.</p>
<section id="rtl-kernel">
<h3>7.1 RTL Kernel<a class="headerlink" href="#rtl-kernel" title="Permalink to this heading">¶</a></h3>
<p>Package the RTL kernel as XO file. Then modify 2 files: ‘vitis_prj/Makefile’, and ‘vitis_prj/scripts/xv2dpu_aie_noc.py’,</p>
<ol class="simple">
<li><p>‘vitis_prj/Makefile’:</p></li>
</ol>
<ul class="simple">
<li><p>Add the name of XO files in the parameters ‘BINARY_CONTAINER_1_OBJS’ by adding following command</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BINARY_CONTAINER_1_OBJS</span>   <span class="o">+=</span> <span class="n">xxx</span><span class="o">.</span><span class="n">xo</span>
</pre></div>
</div>
<ul class="simple">
<li><p>In the v++ linking command line, specify the clock frequency for the clock soure of RTL kernel.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">clock</span><span class="o">.</span><span class="n">freqHz</span> <span class="o">&lt;</span><span class="n">freqHz</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">kernelName</span><span class="o">.</span><span class="n">clk_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>‘vitis_prj/scripts/xvdpu_aie_noc.py’:</p></li>
</ol>
<ul class="simple">
<li><p>Create instance for the RTL kernel, and map kernel ports to memory (NOC)</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">+=</span> <span class="s2">&quot;nk=&lt;kernel name&gt;:&lt;number&gt;:&lt;cu_name&gt;.&lt;cu_name&gt;...</span><span class="se">\n</span><span class="s2">&quot;</span> 
</pre></div>
</div>
<p><strong>Note:</strong> For support with adding AI Engine kernel or RTL + AI Engine kernels to this design, please reach out to us for support.</p>
</section>
</section>
<section id="known-issues">
<h2>8 Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this heading">¶</a></h2>
<ol class="simple">
<li><p>This TRD has updated to support rev-B ES vek280 board, if you want to use it on rev-A board, the Ethernet will not work, you can use a USB Ethernet Adapter to workaround this issue.</p></li>
<li><p>For this version trd, it only can support part of the Modelzoo.</p></li>
<li><p>The app/model/resnet50.xmodel only support the default arch setting(BATCH_SingleCU=1), for other batch setting, it is needed to compile the corresponding xmodel.</p></li>
<li><p>It is suggested to add the following line to your tcl scripts ‘$HOME/.Xilinx/Vivado/Vivado_init.tcl’. For details about ‘Vivado_init.tcl’, please refer to the link page ‘https://docs.xilinx.com/r/en-US/ug894-vivado-tcl-scripting/Initializing-Tcl-Scripts’. This setting can help to optimize the ddr r/w performance by preplacing the NoC netlist.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_param</span> <span class="n">place</span><span class="o">.</span><span class="n">preplaceNOC</span> <span class="n">true</span>
</pre></div>
</div>
<!--
                                                                         
* Copyright 2019 Xilinx Inc.                                               
*                                                                          
* Licensed under the Apache License, Version 2.0 (the "License");          
* you may not use this file except in compliance with the License.         
* You may obtain a copy of the License at                                  
*                                                                          
*    http://www.apache.org/licenses/LICENSE-2.0                            
*                                                                          
* Unless required by applicable law or agreed to in writing, software      
* distributed under the License is distributed on an "AS IS" BASIS,        
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
* See the License for the specific language governing permissions and      
* limitations under the License.                                           

--></section>
</section>


           </div>
          </div>
          
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../workflow-system-integration.html" class="btn btn-neutral float-left" title="What is a DPU?" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../workflow-model-zoo.html" class="btn btn-neutral float-right" title="Vitis AI Model Zoo" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on June 29, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>